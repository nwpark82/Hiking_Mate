# ë“±ì‚°ë¡œ ë°ì´í„° ì •ì œ ê°€ì´ë“œ

## ğŸ“Š ì›ì²œ ë°ì´í„° êµ¬ì¡°

```
.rawdata/
â””â”€â”€ í•œêµ­ë“±ì‚°íŠ¸ë ˆí‚¹ì§€ì›ì„¼í„°_ì‚°ë¦¼ì²­ 100ëŒ€ëª…ì‚°_20220112/
    â””â”€â”€ 100ëŒ€ëª…ì‚°/
        â”œâ”€â”€ ê°€ë¦¬ì‚°/
        â”‚   â”œâ”€â”€ ê°€ë¦¬ì‚°_0000000001.gpx
        â”‚   â”œâ”€â”€ ê°€ë¦¬ì‚°_0000000002.gpx
        â”‚   â””â”€â”€ ...
        â”œâ”€â”€ ê°ì•…ì‚°/
        â”‚   â”œâ”€â”€ ê°ì•…ì‚°_0000000001.gpx
        â”‚   â””â”€â”€ ...
        â””â”€â”€ ... (100ê°œ ì‚°)
```

### GPX íŒŒì¼ êµ¬ì¡°
- **Metadata**: ê²½ê³„ ì¢Œí‘œ (bounds)
- **Waypoints (wpt)**: POI ì •ë³´
  - ì£¼ì°¨ì¥ (PARK)
  - ì‹ë‹¹/ë§¤ì  (STORE)
  - ê°ˆë¦¼ê¸¸ (SIGN)
  - ê¸°íƒ€ (TRANS, ETC)
- **Track (trk/trkpt)**: GPS ì¢Œí‘œ
  - ìœ„ë„ (lat)
  - ê²½ë„ (lon)
  - ê³ ë„ (ele)
  - ì‹œê°„ (time)

## ğŸ”„ ë°ì´í„° ì •ì œ í”„ë¡œì„¸ìŠ¤

### 1ë‹¨ê³„: GPX íŒŒì‹±

**ì˜µì…˜ 1: 100ëŒ€ëª…ì‚°ë§Œ íŒŒì‹±**
```bash
npm run parse-gpx
```

**ì˜µì…˜ 2: ëª¨ë“  ì¹´í…Œê³ ë¦¬ íŒŒì‹± (ê¶Œì¥)**
```bash
npm run parse-all
```

**ì²˜ë¦¬ ì¹´í…Œê³ ë¦¬:**
- âœ… ì‚°ë¦¼ì²­ 100ëŒ€ëª…ì‚° (mountain)
- âœ… êµ­ê°€ìˆ²ê¸¸ ì½”ìŠ¤ (forest)
- â³ 9ì •ë§¥ ì¢…ì£¼ì½”ìŠ¤ (ì¶”í›„ êµ¬í˜„)
- â³ ë°±ë‘ëŒ€ê°„ ì¢…ì£¼ê¸¸ (ì¶”í›„ êµ¬í˜„)

**ìˆ˜í–‰ ì‘ì—…:**
- ëª¨ë“  GPX íŒŒì¼ íŒŒì‹±
- ê±°ë¦¬ ê³„ì‚° (Haversine ê³µì‹)
- ê³ ë„ ì°¨ ê³„ì‚°
- ë‚œì´ë„ ì¶”ì • (easy/normal/hard/expert)
- ì˜ˆìƒ ì†Œìš” ì‹œê°„ ê³„ì‚°
- JSON íŒŒì¼ë¡œ ì €ì¥ (`data/trails.json`)

**ì¶œë ¥ ë°ì´í„° êµ¬ì¡°:**
```json
{
  "mountain": "ê°ì•…ì‚°",
  "courseName": "ê°ì•…ì‚° ì½”ìŠ¤ 1",
  "category": "mountain",
  "difficulty": "normal",
  "distance": 5430,
  "duration": 180,
  "elevationGain": 487,
  "waypoints": [...],
  "trackPoints": [...],
  "bounds": {
    "maxLat": 37.969505,
    "maxLon": 126.971703,
    "minLat": 37.941067,
    "minLon": 126.951920
  }
}
```

### 2ë‹¨ê³„: Supabase ì—…ë¡œë“œ
```bash
npm run upload-trails
```

**ìˆ˜í–‰ ì‘ì—…:**
- `data/trails.json` ì½ê¸°
- Supabase `trails` í…Œì´ë¸”ì— ì‚½ì…
- ì§„í–‰ ìƒí™© ì‹¤ì‹œê°„ í‘œì‹œ
- ì„±ê³µ/ì‹¤íŒ¨ í†µê³„ ì¶œë ¥

**ë§¤í•‘ ê´€ê³„:**
| JSON í•„ë“œ | DB ì»¬ëŸ¼ | ë¹„ê³  |
|-----------|---------|------|
| mountain | mountain | ì‚° ì´ë¦„ |
| courseName | name | ì½”ìŠ¤ ì´ë¦„ |
| difficulty | difficulty | ë‚œì´ë„ |
| distance | distance | ê±°ë¦¬ (m) |
| duration | duration | ì†Œìš”ì‹œê°„ (ë¶„) |
| elevationGain | elevation_gain | ê³ ë„ ì°¨ (m) |
| waypoints, trackPoints, bounds | gpx_data | JSONB |
| bounds ì¤‘ì‹¬ì  | coordinates | JSONB {lat, lng} |

### í†µí•© ì‹¤í–‰
```bash
npm run import-data
```
íŒŒì‹± â†’ ì—…ë¡œë“œë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤.

## ğŸ“ˆ ì˜ˆìƒ ê²°ê³¼

- **ì´ ì‚°**: 100ê°œ
- **ì´ ì½”ìŠ¤**: ì•½ 600~900ê°œ (ì‚°ë§ˆë‹¤ í‰ê·  6~9ê°œ ì½”ìŠ¤)
- **ë°ì´í„° í¬ê¸°**: ì•½ 50~100MB

## ğŸ› ï¸ ë‚œì´ë„ ê³„ì‚° ë¡œì§

```typescript
function estimateDifficulty(distance: number, elevationGain: number): string {
  const score = distance / 1000 + elevationGain / 100;

  if (score < 5) return 'easy';      // ì‰¬ì›€
  if (score < 10) return 'normal';   // ë³´í†µ
  if (score < 15) return 'hard';     // ì–´ë ¤ì›€
  return 'expert';                   // ì „ë¬¸ê°€
}
```

**ì˜ˆì‹œ:**
- 3km, 200m ìƒìŠ¹ = 5ì  â†’ **ì‰¬ì›€**
- 5km, 400m ìƒìŠ¹ = 9ì  â†’ **ë³´í†µ**
- 8km, 600m ìƒìŠ¹ = 14ì  â†’ **ì–´ë ¤ì›€**
- 10km, 800m ìƒìŠ¹ = 18ì  â†’ **ì „ë¬¸ê°€**

## â±ï¸ ì†Œìš” ì‹œê°„ ê³„ì‚° ë¡œì§

```typescript
function estimateDuration(distance: number, elevationGain: number): number {
  // í‰ì§€: 2km/h (30ë¶„/km)
  // ìƒìŠ¹: 300m/h (5ë¶„/100m)
  const flatTime = (distance / 1000) * 30;
  const elevationTime = elevationGain / 5;
  return Math.round(flatTime + elevationTime);
}
```

## ğŸ” í˜„ì¬ ë°ì´í„° ìƒíƒœ

### âœ… í¬í•¨ëœ ë°ì´í„°
- âœ… ì½”ìŠ¤ëª… (ì‚°/ê¸¸ ì´ë¦„ + ì½”ìŠ¤ ë²ˆí˜¸)
- âœ… ê±°ë¦¬ (m)
- âœ… ì†Œìš”ì‹œê°„ (ë¶„)
- âœ… ê³ ë„ ì°¨ì´ (m)
- âœ… ë‚œì´ë„ (easy/normal/hard/expert)
- âœ… GPS ì¢Œí‘œ ë°ì´í„° (ê²½ë¡œ, waypoints)
- âœ… ì¤‘ì‹¬ ì¢Œí‘œ
- âœ… ì¹´í…Œê³ ë¦¬ (mountain/forest ë“±)
- âœ… íŠ¹ì§• íƒœê·¸ (features)

### â³ ì¶”í›„ ì¶”ê°€ ì˜ˆì •
- â³ **ì§€ì—­ ì •ë³´** (region: null)
  - ì¶”í›„ ì¢Œí‘œ ê¸°ë°˜ ì—­ì§€ì˜¤ì½”ë”© ë˜ëŠ” ìˆ˜ë™ ë§¤í•‘ ì˜ˆì •

- â³ **ì´ë¯¸ì§€** (images: [])
  - ì¶”í›„ ê³µê³µë°ì´í„°/ê´€ê´‘ê³µì‚¬ API ë˜ëŠ” ìˆ˜ë™ ì—…ë¡œë“œ ì˜ˆì •

- â³ **ìƒì„¸ ì„¤ëª…** (description: null)
  - ì¶”í›„ ê° ì‚°/ê¸¸ì˜ íŠ¹ì§•, ë³¼ê±°ë¦¬ ë“± ìƒì„¸ ì •ë³´ ì¶”ê°€ ì˜ˆì •

## ğŸ“ ì‚¬ìš© ì˜ˆì‹œ

```bash
# 1. ëª¨ë“  ì¹´í…Œê³ ë¦¬ GPX íŒŒì¼ íŒŒì‹± (ê¶Œì¥)
npm run parse-all

# ì¶œë ¥:
# ğŸ”ï¸  ë“±ì‚°ë¡œ ë°ì´í„° íŒŒì‹± ì‹œì‘...
#
# ğŸ“ 100ëŒ€ëª…ì‚°: 100ê°œ ì‚° ì²˜ë¦¬ ì¤‘...
#   âœ“ 783ê°œ ì½”ìŠ¤ íŒŒì‹± ì™„ë£Œ
#
# ğŸ“ êµ­ê°€ìˆ²ê¸¸: 45ê°œ ì½”ìŠ¤ ì²˜ë¦¬ ì¤‘...
#   âœ“ 234ê°œ ì½”ìŠ¤ íŒŒì‹± ì™„ë£Œ
#
# â­ï¸  9ì •ë§¥ ë°ì´í„° - ì¶”í›„ êµ¬í˜„ ì˜ˆì •
# â­ï¸  ë°±ë‘ëŒ€ê°„ ë°ì´í„° - ì¶”í›„ êµ¬í˜„ ì˜ˆì •
#
# âœ… ì´ 1,017ê°œ ì½”ìŠ¤ ì €ì¥ ì™„ë£Œ: data/trails.json
#
# ğŸ“Š ì¹´í…Œê³ ë¦¬ë³„ í†µê³„:
#   - mountain: 783ê°œ
#   - forest: 234ê°œ
#
# ğŸ“Š ë‚œì´ë„ë³„ í†µê³„:
#   - easy: 245ê°œ
#   - normal: 512ê°œ
#   - hard: 198ê°œ
#   - expert: 62ê°œ

# 2. Supabaseì— ì—…ë¡œë“œ
npm run upload-trails

# ì¶œë ¥:
# ğŸ“‚ Loaded 1,017 trails from data/trails.json
#
# â¬†ï¸  Uploading trails to Supabase...
#
# âœ“ ê°ì•…ì‚° 1 - 5430m
# âœ“ ë‚´í¬ë¬¸í™”ìˆ²ê¸¸ 2 - 12500m
# ...
#
# ğŸ“Š Upload Summary:
#   âœ… Success: 1,017
#   âŒ Failed: 0
#   ğŸ“ˆ Total: 1,017

# ë˜ëŠ” í•œ ë²ˆì— ì‹¤í–‰
npm run import-data
```

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **Supabase Rate Limit**: ì—…ë¡œë“œ ì‹œ 100ms ë”œë ˆì´ ì¶”ê°€ë˜ì–´ ìˆìŒ
2. **ë©”ëª¨ë¦¬ ì‚¬ìš©**: ëŒ€ìš©ëŸ‰ GPX íŒŒì¼ íŒŒì‹± ì‹œ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í™•ì¸
3. **í™˜ê²½ ë³€ìˆ˜**: `.env.local`ì— Supabase ìê²©ì¦ëª… í•„ìš”
4. **ë°±ì—…**: ì—…ë¡œë“œ ì „ ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… ê¶Œì¥

## ğŸ”„ ì¬ì‹¤í–‰ ì‹œ ì£¼ì˜

trails í…Œì´ë¸”ì— ì¤‘ë³µ ë°ì´í„°ê°€ ìƒì„±ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì¬ì‹¤í–‰ ì „ ê¸°ì¡´ ë°ì´í„° ì‚­ì œ:

```sql
DELETE FROM trails WHERE mountain IN ('ê°€ë¦¬ì‚°', 'ê°ì•…ì‚°', ...);
-- ë˜ëŠ”
TRUNCATE TABLE trails CASCADE;
```
